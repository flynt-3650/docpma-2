# Архитектура Riverpod в проекте

## Схема взаимодействия компонентов

```
┌─────────────────────────────────────────────────────────────┐
│                        ProviderScope                         │
│                   (Корневой контейнер)                       │
└───────────────────────────┬─────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                     MaterialApp.router                       │
│                      (GoRouter)                              │
└───────────────────────────┬─────────────────────────────────┘
                            │
        ┌───────────────────┴───────────────────┐
        │                                       │
        ▼                                       ▼
┌──────────────────┐                  ┌──────────────────┐
│  ConsumerWidget  │                  │ ConsumerStateful │
│                  │                  │     Widget       │
└────────┬─────────┘                  └────────┬─────────┘
         │                                     │
         │ ref.watch() / ref.read()            │
         │                                     │
         ▼                                     ▼
┌─────────────────────────────────────────────────────────────┐
│                      ПРОВАЙДЕРЫ                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  1. StateNotifierProvider<TasksNotifier>           │    │
│  │     - Управление списком задач                     │    │
│  │     - CRUD операции                                │    │
│  └────────────────────────────────────────────────────┘    │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  2. Provider.family<Task?, String>                 │    │
│  │     - Получение задачи по ID                       │    │
│  │     - Параметризованный провайдер                  │    │
│  └────────────────────────────────────────────────────┘    │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  3. StreamProvider<DateTime>                       │    │
│  │     - Поток с текущим временем                     │    │
│  │     - Обновление каждую секунду                    │    │
│  └────────────────────────────────────────────────────┘    │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  4. FutureProvider<int>                            │    │
│  │     - Асинхронная загрузка данных                  │    │
│  │     - Симуляция задержки                           │    │
│  └────────────────────────────────────────────────────┘    │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  5. Computed Providers                             │    │
│  │     - completedTasksProvider                       │    │
│  │     - inProgressTasksProvider                      │    │
│  └────────────────────────────────────────────────────┘    │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  6. StateProvider<T>                               │    │
│  │     - counterProvider (int)                        │    │
│  │     - isDarkModeProvider (bool)                    │    │
│  │     - userNameProvider (String)                    │    │
│  └────────────────────────────────────────────────────┘    │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  7. Provider<String>                               │    │
│  │     - appVersionProvider                           │    │
│  │     - Неизменяемое значение                        │    │
│  └────────────────────────────────────────────────────┘    │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## Потоки данных

### 1. Чтение данных (ref.watch)
```
Screen (ConsumerWidget)
    │
    │ ref.watch(tasksProvider)
    │
    ▼
Provider возвращает данные
    │
    ▼
UI перестраивается автоматически
```

### 2. Изменение данных (ref.read)
```
Screen нажатие кнопки
    │
    │ ref.read(tasksProvider.notifier).addTask(...)
    │
    ▼
StateNotifier обновляет state
    │
    ▼
Все слушатели (ref.watch) получают новые данные
    │
    ▼
UI автоматически перестраивается
```

### 3. Асинхронные операции (FutureProvider)
```
Screen (ConsumerWidget)
    │
    │ ref.watch(asyncTasksCountProvider)
    │
    ▼
Provider начинает Future
    │
    ├──► loading: показываем CircularProgressIndicator
    │
    ├──► data: показываем результат
    │
    └──► error: показываем ошибку
```

### 4. Потоки (StreamProvider)
```
Screen (ConsumerWidget)
    │
    │ ref.watch(timeStreamProvider)
    │
    ▼
Provider подписывается на Stream
    │
    ▼
Stream эмитит новое значение каждую секунду
    │
    ▼
UI обновляется с новым значением
```

## Экраны и их провайдеры

```
┌─────────────────────────────────────────────────────────────┐
│                    TaskListScreen                            │
│  Использует:                                                 │
│  - tasksProvider (StateNotifierProvider)                     │
│  Операции:                                                   │
│  - Чтение списка задач (ref.watch)                           │
│  - Удаление задачи (ref.read)                                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    TaskFormScreen                            │
│  Использует:                                                 │
│  - taskByIdProvider.family (Provider.family)                 │
│  - tasksProvider.notifier                                    │
│  Операции:                                                   │
│  - Получение задачи по ID (ref.watch)                        │
│  - Создание/обновление задачи (ref.read)                     │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                  TaskDetailsScreen                           │
│  Использует:                                                 │
│  - taskByIdProvider.family (Provider.family)                 │
│  - timeStreamProvider (StreamProvider)                       │
│  Операции:                                                   │
│  - Получение задачи по ID (ref.watch)                        │
│  - Отображение времени в реальном времени (ref.watch)        │
│  - Удаление задачи (ref.read)                                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                   StatisticsScreen                           │
│  Использует:                                                 │
│  - tasksProvider (StateNotifierProvider)                     │
│  - completedTasksProvider (Computed Provider)                │
│  - inProgressTasksProvider (Computed Provider)               │
│  - asyncTasksCountProvider (FutureProvider)                  │
│  Операции:                                                   │
│  - Чтение статистики (ref.watch)                             │
│  - Асинхронная загрузка (ref.watch с .when())                │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    SettingsScreen                            │
│  Использует:                                                 │
│  - counterProvider (StateProvider)                           │
│  - isDarkModeProvider (StateProvider)                        │
│  - userNameProvider (StateProvider)                          │
│  - appVersionProvider (Provider)                             │
│  Операции:                                                   │
│  - Чтение настроек (ref.watch)                               │
│  - Изменение настроек (ref.read().state = newValue)          │
└─────────────────────────────────────────────────────────────┘
```

## Жизненный цикл провайдеров

```
1. Инициализация приложения
   └─> ProviderScope создается
       └─> Все провайдеры регистрируются

2. Первое использование провайдера
   └─> Провайдер инициализируется лениво
       └─> Создается начальное состояние

3. ref.watch() подписывается
   └─> Виджет добавляется в список слушателей
       └─> При изменении провайдера виджет перестраивается

4. Изменение состояния
   └─> StateNotifier.state = newState
       └─> Все слушатели уведомляются
           └─> Виджеты перестраиваются

5. Удаление виджета
   └─> Автоматическая отписка от провайдера
       └─> Если больше нет слушателей, провайдер может быть очищен
```

## Типы провайдеров и их применение

| Провайдер | Когда использовать | Изменяемость | Пример |
|-----------|-------------------|--------------|--------|
| **Provider** | Константы, сервисы | ❌ Нет | Версия приложения |
| **StateProvider** | Простые значения | ✅ Да | Счетчик, флаги |
| **StateNotifierProvider** | Сложная логика | ✅ Да | Список задач |
| **FutureProvider** | Async/await | ❌ Нет | API запросы |
| **StreamProvider** | Потоки данных | ❌ Нет | WebSocket, Timer |
| **Provider.family** | С параметрами | ❌ Нет | Задача по ID |

## Преимущества архитектуры

✅ **Разделение ответственности**: UI отделен от бизнес-логики  
✅ **Переиспользование**: Провайдеры можно использовать в разных экранах  
✅ **Тестируемость**: Легко мокировать провайдеры  
✅ **Типобезопасность**: Ошибки на этапе компиляции  
✅ **Производительность**: Перестраиваются только нужные виджеты  
✅ **Масштабируемость**: Легко добавлять новые провайдеры  

## Сравнение с другими решениями

| Аспект | Riverpod | Provider | Bloc | GetX |
|--------|----------|----------|------|------|
| Зависимость от context | ❌ Нет | ✅ Да | ❌ Нет | ❌ Нет |
| Типобезопасность | ✅ Да | ⚠️ Частично | ✅ Да | ❌ Нет |
| Множество типов | ✅ 7+ типов | ⚠️ 3 типа | ⚠️ 1 тип | ⚠️ 1 тип |
| Кривая обучения | ⚠️ Средняя | ✅ Низкая | ❌ Высокая | ✅ Низкая |
| Поддержка сообщества | ✅ Отличная | ✅ Отличная | ✅ Отличная | ⚠️ Средняя |

